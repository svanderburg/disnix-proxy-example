#!/bin/bash -e

export PATH=@PREFIX@/bin:$PATH

case "$1" in
    activate)
	nohup disnix-tcp-proxy @srcPort@ @destHostname@ @destPort@ > /var/log/$(basename @PREFIX@).log & pid=$!
	echo $pid > /var/run/$(basename @PREFIX@).pid
        ;;
    deactivate)
        kill $(cat /var/run/@PREFIX@.pid)
	rm -f /var/run/$(basename @PREFIX@).pid
        ;;
    lock)
        test $(disnix-tcp-proxy-client) = "0"
	touch /tmp/$(basename @PREFIX@).lock
        ;;
    unlock)
        rm -f /tmp/$(basename @PREFIX@).lock
        ;;
esac
